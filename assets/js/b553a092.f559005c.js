"use strict";(globalThis.webpackChunkthoughtjack_docs_site=globalThis.webpackChunkthoughtjack_docs_site||[]).push([[8542],{1557(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"how-to/ci-integration","title":"Integrate with CI/CD","description":"Run ThoughtJack in CI pipelines with machine-readable output","source":"@site/docs/how-to/ci-integration.mdx","sourceDirName":"how-to","slug":"/how-to/ci-integration","permalink":"/thoughtjack/docs/how-to/ci-integration","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"title":"Integrate with CI/CD","sidebar_position":7,"description":"Run ThoughtJack in CI pipelines with machine-readable output"},"sidebar":"docs","previous":{"title":"Run Over HTTP Transport","permalink":"/thoughtjack/docs/how-to/http-transport"},"next":{"title":"Use Dynamic Response Handlers","permalink":"/thoughtjack/docs/how-to/dynamic-responses"}}');var i=t(4848),a=t(8453);const r={title:"Integrate with CI/CD",sidebar_position:7,description:"Run ThoughtJack in CI pipelines with machine-readable output"},o="Integrate with CI/CD",c={},l=[{value:"Validate configs in CI",id:"validate-configs-in-ci",level:2},{value:"Machine-readable output",id:"machine-readable-output",level:2},{value:"JSON log format",id:"json-log-format",level:2},{value:"Event file output",id:"event-file-output",level:2},{value:"Traffic capture",id:"traffic-capture",level:2},{value:"Exit codes",id:"exit-codes",level:2},{value:"Validate generated docs",id:"validate-generated-docs",level:2},{value:"Prometheus metrics",id:"prometheus-metrics",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"integrate-with-cicd",children:"Integrate with CI/CD"})}),"\n",(0,i.jsx)(n.p,{children:"ThoughtJack can run in CI/CD pipelines to validate configurations and test MCP client implementations against attack scenarios."}),"\n",(0,i.jsx)(n.h2,{id:"validate-configs-in-ci",children:"Validate configs in CI"}),"\n",(0,i.jsx)(n.p,{children:"Add config validation to your pipeline to catch errors before deployment:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title=".github/workflows/validate.yml"',children:"name: Validate ThoughtJack Configs\non: [push, pull_request]\n\njobs:\n  validate:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install ThoughtJack\n        run: |\n          curl --proto '=https' --tlsv1.2 -LsSf \\\n            https://github.com/thoughtgate/thoughtjack/releases/latest/download/thoughtjack-installer.sh | sh\n\n      - name: Validate all configs\n        run: |\n          for f in library/servers/*.yaml; do\n            thoughtjack server validate \"$f\" --format json\n          done\n"})}),"\n",(0,i.jsx)(n.h2,{id:"machine-readable-output",children:"Machine-readable output"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"--format json"})," for structured output from validation and listing commands:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# JSON validation output\nthoughtjack server validate my_config.yaml --format json\n\n# JSON scenario listing\nthoughtjack scenarios list --format json\n"})}),"\n",(0,i.jsx)(n.h2,{id:"json-log-format",children:"JSON log format"}),"\n",(0,i.jsx)(n.p,{children:"When running the server in CI, use JSON logs for machine parsing:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"thoughtjack server run --config my_config.yaml --log-format json -vv\n"})}),"\n",(0,i.jsx)(n.p,{children:"Each log line is a JSON object:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{"timestamp":"2025-01-15T10:30:00Z","level":"INFO","target":"thoughtjack::phase","message":"Phase transition","phase":"exploit"}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"event-file-output",children:"Event file output"}),"\n",(0,i.jsx)(n.p,{children:"Write structured events to a JSONL file for post-run analysis:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"thoughtjack server run \\\n  --config my_config.yaml \\\n  --events-file events.jsonl \\\n  --log-format json\n"})}),"\n",(0,i.jsxs)(n.p,{children:["After the run, parse ",(0,i.jsx)(n.code,{children:"events.jsonl"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Count phase transitions\njq 'select(.event == \"PhaseEntered\")' events.jsonl | wc -l\n\n# Get run summary\njq 'select(.event == \"ServerStopped\") | .summary' events.jsonl\n"})}),"\n",(0,i.jsx)(n.h2,{id:"traffic-capture",children:"Traffic capture"}),"\n",(0,i.jsx)(n.p,{children:"Capture all request/response traffic for analysis:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"thoughtjack server run \\\n  --config my_config.yaml \\\n  --capture-dir ./captures \\\n  --capture-redact\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"--capture-redact"})," flag removes potentially sensitive values from captured traffic."]}),"\n",(0,i.jsx)(n.h2,{id:"exit-codes",children:"Exit codes"}),"\n",(0,i.jsx)(n.p,{children:"ThoughtJack uses specific exit codes that CI pipelines can check:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Code"}),(0,i.jsx)(n.th,{children:"Meaning"}),(0,i.jsx)(n.th,{children:"CI action"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"0"}),(0,i.jsx)(n.td,{children:"Success"}),(0,i.jsx)(n.td,{children:"Pass"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2"}),(0,i.jsx)(n.td,{children:"Config invalid"}),(0,i.jsx)(n.td,{children:"Fail \u2014 fix config"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"10"}),(0,i.jsx)(n.td,{children:"Generator limit exceeded"}),(0,i.jsx)(n.td,{children:"Fail \u2014 adjust limits"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"64"}),(0,i.jsx)(n.td,{children:"Invalid CLI usage"}),(0,i.jsx)(n.td,{children:"Fail \u2014 fix command"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"130"}),(0,i.jsx)(n.td,{children:"SIGINT"}),(0,i.jsx)(n.td,{children:"Informational"})]})]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"- name: Run scenario\n  run: thoughtjack server run --config test.yaml\n  continue-on-error: false\n"})}),"\n",(0,i.jsx)(n.h2,{id:"validate-generated-docs",children:"Validate generated docs"}),"\n",(0,i.jsx)(n.p,{children:"If you generate documentation, validate it in CI:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"thoughtjack docs generate --output-dir docs-site/docs/scenarios\nthoughtjack docs validate\n"})}),"\n",(0,i.jsx)(n.h2,{id:"prometheus-metrics",children:"Prometheus metrics"}),"\n",(0,i.jsx)(n.p,{children:"For long-running test sessions, expose metrics:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"thoughtjack server run \\\n  --config my_config.yaml \\\n  --http 8080 \\\n  --metrics-port 9090\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Scrape ",(0,i.jsx)(n.code,{children:"http://localhost:9090/metrics"})," for request counts, phase transitions, delivery durations, and error rates."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>r,x:()=>o});var s=t(6540);const i={},a=s.createContext(i);function r(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);